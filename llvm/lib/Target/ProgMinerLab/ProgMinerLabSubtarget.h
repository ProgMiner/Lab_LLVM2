#pragma once

#include "llvm/CodeGen/TargetSubtargetInfo.h"
#include "llvm/CodeGen/SelectionDAGTargetInfo.h"

#include "ProgMinerLabFrameLowering.h"
// #include "ProgMinerLabISelLowering.h"
#include "ProgMinerLabInstrInfo.h"


#define GET_SUBTARGETINFO_HEADER
#include "ProgMinerLabGenSubtargetInfo.inc"


namespace llvm {

class ProgMinerLabSubtarget : public ProgMinerLabGenSubtargetInfo {

    virtual void anchor();

    ProgMinerLabRegisterInfo RegInfo;
    ProgMinerLabInstrInfo InstrInfo;
    ProgMinerLabFrameLowering FrameLowering;
    // ProgMinerLabTargetLowering TLInfo;
    SelectionDAGTargetInfo TSInfo;

public:
    ProgMinerLabSubtarget(
        const Triple & TT,
        const StringRef & CPU,
        const StringRef & FS,
        const TargetMachine & TM
    );

    // ParseSubtargetFeatures - parses features string setting specified subtarget options
    // definition of function is auto generated by tblgen
    void ParseSubtargetFeatures(StringRef CPU, StringRef TuneCPU, StringRef FS);

    const ProgMinerLabRegisterInfo * getRegisterInfo() const override {
        return &RegInfo;
    }

    const ProgMinerLabInstrInfo * getInstrInfo() const override {
        return &InstrInfo;
    }

    const ProgMinerLabFrameLowering * getFrameLowering() const override {
        return &FrameLowering;
    }

    // const ProgMinerLabTargetLowering * getTargetLowering() const override {
    const TargetLowering * getTargetLowering() const override {
        llvm_unreachable("getTargetLowering"); // TODO
        // return &TLInfo;
    }

    const SelectionDAGTargetInfo * getSelectionDAGInfo() const override {
        return &TSInfo;
    }
};

} // namespace llvm
